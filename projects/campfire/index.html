
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>Implementing a Constrained Force-directed Graph on The Campfire - Zhi Zheng</title>

  
    <meta name="description" content="The Campfire is a multi-dimensional visualization tool developed by RPI IDEA, this is a project I worked on that uses a force directed graph in a circular constraint that displays the connection betwe">
<meta property="og:type" content="website">
<meta property="og:title" content="Implementing a Constrained Force-directed Graph on The Campfire">
<meta property="og:url" content="http://lepronliner.github.io/projects/campfire/index.html">
<meta property="og:site_name" content="Zhi Zheng">
<meta property="og:description" content="The Campfire is a multi-dimensional visualization tool developed by RPI IDEA, this is a project I worked on that uses a force directed graph in a circular constraint that displays the connection betwe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/1.jpg">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/fig_1-2.png">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/fig_3.png">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/fig_4.png">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/fig_5-6.png">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/2.jpg">
<meta property="og:image" content="http://lepronliner.github.io/assets/projects/campfire/3.jpg">
<meta property="article:published_time" content="2024-07-23T19:13:44.000Z">
<meta property="article:modified_time" content="2024-07-25T09:28:59.614Z">
<meta property="article:author" content="Zhi Zheng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lepronliner.github.io/assets/projects/campfire/1.jpg">
  
  
  
  

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/cli.css">
  <script src="/js/cli.js"></script>

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  

  

  <link rel="apple-icon-72x72" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"><link rel="android-icon-72x72" sizes="72x72" href="/assets/favicon/android-icon-72x72">
</head>
<body>

<div class="l_body s:aa content story" id="start" layout="page" text-indent><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/assets/photos/butterfly.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Zhi Zheng</div><div class="sub normal cap">Projects</div><div class="sub hover cap" style="opacity:0"> Campfire</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>


<nav class="menu dis-select"><a class="nav-item" title="Home" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="Blogs" href="/blogs/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="about" href="/about/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10" opacity=".5"/><path fill="currentColor" d="M8.397 15.553a.75.75 0 0 1 1.05-.155c.728.54 1.607.852 2.553.852s1.825-.313 2.553-.852a.75.75 0 1 1 .894 1.204A5.766 5.766 0 0 1 12 17.75a5.766 5.766 0 0 1-3.447-1.148a.75.75 0 0 1-.156-1.049M15 12c.552 0 1-.672 1-1.5S15.552 9 15 9s-1 .672-1 1.5s.448 1.5 1 1.5m-6 0c.552 0 1-.672 1-1.5S9.552 9 9 9s-1 .672-1 1.5s.448 1.5 1 1.5"/></svg></a></nav>
</div>
<div class="widgets">
<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2024/08/22/swapping-knights/"><span class="title">Swapping Knights</span></a><a class="item title" href="/2024/08/22/peaceful-rooks/"><span class="title">Peaceful Rooks</span></a><a class="item title" href="/2024/07/21/l2-regularized-lr-math/"><span class="title">L2-regularized Logistic Regression Derived</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>

  <span class="sep"></span>
  <a class="cap breadcrumb" href="/projects/campfire/index.html">Implementing a Constrained Force-directed Graph on The Campfire</a>
  </div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2024-07-23T19:13:44.000Z">2024-07-23</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2024-07-25T09:28:59.614Z">2024-07-25</time></span></div></div></div>
    
  </div>
  </div><article class="md-text content"><div class="tag-plugin banner"><img class="bg lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/1.jpg"><div class="content"><div class="top">
    <button class="back cap" onclick="window.history.back()">
      <svg aria-hidden="true" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M7.78 12.53a.75.75 0 01-1.06 0L2.47 8.28a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L4.81 7h7.44a.75.75 0 010 1.5H4.81l2.97 2.97a.75.75 0 010 1.06z"></path></svg>
    </button>
    </div><div class="bottom"></div></div></div>

<h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>The <em>Campfire</em> is a multi-dimensional display hardware developed by Dr. Ameres to simulate and display unique visualizations. This is a custom visualization tool that parses the total amount of dialogue between a character as a weight and simulating the connection between the relationship between various characters as a dynamic Force Directed Graph constrained to the shape of the display. This visualization includes interactability to see particular connections between various characters.</p>
<div class="tag-plugin colorful folders" ><details class="folder" index="0"><summary><span>Technology/Hardware Stack</span></summary><div class="body"><ul><li>Unity 2021 &amp; C#</li><li>Campfire</li></ul></div></details></div>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The <em>Campfire</em> is a visualization tool developed by the Rensselaer IDEA in order to demonstrate a multi-user, collaborative environment. [1, 2] Therefore, several ideas including graphs, were proposed to be incorporated into the campfire identity. One of which is a force-directed graph, implemented to suit the specifications of the campfire. This graph algorithm, a force-directed graph, offers dynamic usage and generation [3], with a geometric constraint we are able to reduce the visual complexity of the graph as well as making it suitable for the campfire. This is done by using the edges of the campfire as a constraint.</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/fig_1-2.png"/></div></div>

<p>In the figure 1, the nodes are generated in a random location due to the radius of the constraint and in figure 2 the nodes are in equilibrium and constrained to the shape we assign it to (circle). Moreover, the graph parses in information of the nodes and edges given the format of two .csv files. One of which is a file of nodes represented by their ID and name, the second is the node and their target, which makes up an edge, and that edge weight.</p>
<div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">
    <div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/fig_3.png"/></div></div>
    </div>
    <div class="cell" style="">
    <p>In the figure 1, the nodes are generated in a random location due to the radius of the constraint and in figure 2 the nodes are in equilibrium and constrained to the shape we assign it to (circle). Moreover, the graph parses in information of the nodes and edges given the format of two .csv files. One of which is a file of nodes represented by their ID and name, the second is the node and their target, which makes up an edge, and that edge weight.</p>
    </div>
    </div>

<h1 id="Abstract-Implementation"><a href="#Abstract-Implementation" class="headerlink" title="Abstract Implementation"></a>Abstract Implementation</h1><p>The graph is generated by parsing in nodes and their relevant connections (edges), for each node there exists a weight, which defines the force pulling a node to another node defined through a spring. Then, we have a constraint that will pull the nodes to a stable equilibrium, which establishes a geometric pattern of nodes. This geometric constraint is the <em>Campfire</em>, with a radius calculated based on the total nodes that would wrap around this constraint. Thus all of the nodes generated would fit in a circular equilibrium with all nodes (spheres) tangent to each other adjacent node. The constraint has a spring force larger than any other weight force in order to forcibly pull the node to that equilibrium.</p>
<p>Moreover, we are able to visualize the connections of each node by adding a line that represents an edge. This edge only can be viewed if we select that node and examine its edges, otherwise all edges are hidden for clarity. With the <em>Campfire</em>, every node includes a non-collidable quad that represents an interactable node, this would indicate the node of the node and color in order to make them visually distinct. A possible future implementation would extend these values to depict other qualities of the nodes or connections. The lines are rendered to develop a visualization similar to a chord diagram. [4]</p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/fig_4.png"/></div></div>

<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p>With an implementation of the graph, we are able to demonstrate specific character interactions from the popular book series Game of Thrones, more specifically A Song of Ice and Fire, from author George R.R. Martin. From the dataset provided by Beveridge [5], for each book (1 to 5) and all the books, we are able to generate a constrained force-directed graph, and have it demonstrated on the campfire. Moreover, since the graphs are dynamically generated and loaded, we are able to store the data and generate the graph at runtime in the Campfire. The graph displays adjacent nodes as viewable quads. On each quad, a character’s name is written, and for every connection to the selected node their character is written. </p>
<div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/fig_5-6.png"/></div></div>

<p>Furthermore, with the capabilities of a game engine, Unity, and the visual platform of the <em>Campfire</em>, it is possible to dynamically construct any graphs given the correct set of data provided the format of the parser.</p>
<div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">
    <div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/2.jpg"/></div></div>
    </div>
    <div class="cell" style="">
    <div class="tag-plugin image"><div class="image-bg"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/projects/campfire/3.jpg"/></div></div>
    </div>
    </div>

<h1 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h1><p>This section is under many constant updates and can variable change over time, consider this part under construction for now. I have included a link of this project below.</p>
<div class="tag-plugin link dis-select"><a class="link-card plain" title="GitHub" href="https://github.com/LepronlineR/FDGUnity/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill=""><div class="left"><span class="title">GitHub</span><span class="cap link footnote">https://github.com/LepronlineR/FDGUnity/</span></div><div class="right"><div class="lazy img" data-bg="/assets/photos/github.png"></div></div></a></div>

<h2 id="Data-Parsing"><a href="#Data-Parsing" class="headerlink" title="Data Parsing"></a>Data Parsing</h2><p>The data provided by the interaction of characters between ASOIAF is given by the edges and nodes. Represented as:</p>
<div class="tag-plugin grid"  style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"><div class="cell" style="">
    <p><strong>Edges</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Source,Target,Type,id,weight</span><br><span class="line">Addam-Marbrand,Brynden-Tully,Undirected,0,3</span><br><span class="line">Addam-Marbrand,Cersei-Lannister,Undirected,1,3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
    </div>
    <div class="cell" style="">
    <p><strong>Nodes</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Id,Label</span><br><span class="line">Addam-Marbrand,Addam Marbrand</span><br><span class="line">Aegon-Frey-(son-of-Stevron),Aegon Frey (son of Stevron)</span><br><span class="line">Aegon-I-Targaryen,Aegon I Targaryen</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
    </div>
    </div>

<p>We can easily extract this data and store it in some arbitrary class for further evaluation, this allows us to obtain the exact values for the minimum and maximum weights we require for the data. <strong>Note</strong>: The code blocks here do not include all of the fields, functions, etc that makes the implementation function, just think of them like pseudocode. For the full code implementation I have linked a github repo of the partial implementation below.</p>
<!-- cell -->
<div class="tag-plugin colorful note" child="codeblock"><div class="body"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Data</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span>[] fields;     <span class="comment">// Source, Target, Type, id, weight</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">string</span>[]&gt; data; <span class="comment">// Addam-Marbrand,Brynden-Tully,Undirected,0,3...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> (<span class="built_in">int</span>, <span class="built_in">int</span>) evaluateMinMaxWeights()&#123;</span><br><span class="line">        <span class="built_in">int</span> save = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="built_in">string</span> str <span class="keyword">in</span> fields)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str.Equals(<span class="string">&quot;weights&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            save += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> max = <span class="built_in">int</span>.MinValue;</span><br><span class="line">        <span class="built_in">int</span> min = Int32.Parse(data[<span class="number">0</span>][save]);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="built_in">string</span>[] line <span class="keyword">in</span> data)&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="built_in">string</span> str <span class="keyword">in</span> line)&#123;</span><br><span class="line">                <span class="built_in">int</span> temp = Int32.Parse(str);</span><br><span class="line">                <span class="keyword">if</span>(temp &gt; max)&#123;</span><br><span class="line">                    max = temp;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(temp &lt; min)&#123;</span><br><span class="line">                    min = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (min, max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>

<h2 id="Nodes-and-Edges"><a href="#Nodes-and-Edges" class="headerlink" title="Nodes and Edges"></a>Nodes and Edges</h2><p>Before parsing the data into the graph, it is imperative that we should define the general use cases for the node and edge data that we can parse into that creates the graph. Furthermore, note that we inherit unity’s monobehaviour s.t. it can utilize GameObjects and can be physics objects.</p>
<!-- cell -->
<div class="tag-plugin colorful note" child="codeblock"><div class="body"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Node</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    NodeData nodeData; <span class="comment">// this data holds the id, name, color, other connection names and edge data</span></span><br><span class="line">    List&lt;Edge&gt; edges = <span class="keyword">new</span> List&lt;Edge&gt;();</span><br><span class="line">    ... </span><br><span class="line"></span><br><span class="line">    <span class="comment">// represents the GO/Transform that holds Node</span></span><br><span class="line">    <span class="keyword">public</span> GameObject gameObj &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Edge</span> &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>

<h2 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h2><p>Here, all we need to do is to create a dictionary that can abstract all of the data for our use case</p>
<!-- cell -->
<div class="tag-plugin colorful note" child="codeblock"><div class="body"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Dictionary&lt;<span class="built_in">string</span>, NodeData&gt; <span class="title">generateNodeDataFromCSV</span>(<span class="params">Data nodes, Data edges</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// obtain the nodes</span></span><br><span class="line">		<span class="comment">/*		From the example</span></span><br><span class="line"><span class="comment">				Id,						Label</span></span><br><span class="line"><span class="comment">				Addam-Marbrand,			Addam Marbrand</span></span><br><span class="line"><span class="comment">				[0] --&gt; ID				[1] --&gt; Name</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		Dictionary&lt;<span class="built_in">string</span>, NodeData&gt; result = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, NodeData&gt;();</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="built_in">string</span>[] line <span class="keyword">in</span> nodes.data)&#123;</span><br><span class="line">			NodeData node = <span class="keyword">new</span> NodeData();</span><br><span class="line">			node.ID = line[<span class="number">0</span>];</span><br><span class="line">			node.Name = line[<span class="number">1</span>];</span><br><span class="line">			<span class="comment">// set the node&#x27;s color to random</span></span><br><span class="line">			node.COLOR = Random.ColorHSV(<span class="number">0f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">0.5f</span>, <span class="number">1f</span>);</span><br><span class="line">			result.Add(node.ID, node);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// set the edges</span></span><br><span class="line">		<span class="comment">/*		From the example</span></span><br><span class="line"><span class="comment">				Source,				Target,			Type,		id,			weight</span></span><br><span class="line"><span class="comment">				Addam-Marbrand,		Brynden-Tully,	Undirected,	0,			3</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">			Person -&gt; One</span></span><br><span class="line"><span class="comment">			search for Person </span></span><br><span class="line"><span class="comment">			NodeData:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">			Person ID: Person-Person, List&lt;EdgeData&gt; = [One];</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">foreach</span>(<span class="built_in">string</span>[] line <span class="keyword">in</span> edges.data)&#123;</span><br><span class="line">			NodeData source;</span><br><span class="line">			<span class="comment">// get source</span></span><br><span class="line">			<span class="keyword">if</span>(result.TryGetValue(line[<span class="number">0</span>], <span class="keyword">out</span> source))&#123;</span><br><span class="line">				<span class="comment">// get target</span></span><br><span class="line">				NodeData target;</span><br><span class="line">				<span class="keyword">if</span>(result.TryGetValue(line[<span class="number">1</span>], <span class="keyword">out</span> target))&#123;</span><br><span class="line">					EdgeData newEdge = <span class="keyword">new</span> EdgeData(target, line[<span class="number">4</span>]);</span><br><span class="line">					source.addToEdge(newEdge);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					Debug.Log(<span class="string">&quot;Target: &quot;</span> + line[<span class="number">1</span>] + <span class="string">&quot; has not been found.&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				Debug.Log(<span class="string">&quot;Source: &quot;</span> + line[<span class="number">0</span>] + <span class="string">&quot; has not been found.&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div></div>

<p>Finally, we can take this generated dictionary of node datas and generate a graph</p>
<!-- cell -->
<div class="tag-plugin colorful note" child="codeblock"><div class="body"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generateGraphFromNodeData</span>(<span class="params">Dictionary&lt;<span class="built_in">string</span>, NodeData&gt; nodeData</span>)</span>&#123;</span><br><span class="line">		Dictionary&lt;NodeData, Node&gt; nodes = <span class="keyword">new</span> Dictionary&lt;NodeData, Node&gt;();</span><br><span class="line">		<span class="comment">// generate the nodes</span></span><br><span class="line">		<span class="keyword">foreach</span>(KeyValuePair&lt;<span class="built_in">string</span>, NodeData&gt; data <span class="keyword">in</span> nodeData)&#123;</span><br><span class="line">			GameObject obj = (GameObject) Instantiate(nodePrefab, <span class="keyword">new</span> Vector3(Random.Range(-size, size), <span class="number">0.0f</span>, Random.Range(-size, size)), Quaternion.identity);</span><br><span class="line">			obj.name = data.Key;</span><br><span class="line">			obj.transform.parent = transform;</span><br><span class="line">			obj.GetComponent&lt;Node&gt;().Data = data.Value;</span><br><span class="line">			obj.GetComponent&lt;Node&gt;().gameObj = obj;</span><br><span class="line">			nodes.Add(data.Value, obj.GetComponent&lt;Node&gt;());</span><br><span class="line">			obj.GetComponent&lt;Node&gt;().setName();</span><br><span class="line">			obj.GetComponent&lt;Node&gt;().setColor();</span><br><span class="line">			obj.GetComponent&lt;Node&gt;().show = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// set the edges based on each node</span></span><br><span class="line">		<span class="keyword">foreach</span>(KeyValuePair&lt;NodeData, Node&gt; node <span class="keyword">in</span> nodes)&#123;</span><br><span class="line">			<span class="keyword">foreach</span>(EdgeData edge <span class="keyword">in</span> node.Key.Edges)&#123;</span><br><span class="line">				<span class="comment">// get target</span></span><br><span class="line">				NodeData target = edge.Node;</span><br><span class="line">				Node recievingNode;</span><br><span class="line">				<span class="keyword">if</span>(nodes.TryGetValue(target, <span class="keyword">out</span> recievingNode))&#123;</span><br><span class="line">					<span class="comment">// add the edge</span></span><br><span class="line">					node.Value.addEdge(recievingNode, edge.Weight, node.Value.getName() + <span class="string">&quot; (Edge)&quot;</span>, defaultLRMaterial);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					Debug.Log(<span class="string">&quot;[generateGraphFromNodeData()] Target: &quot;</span> + target.ID + <span class="string">&quot; has not been found.&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			node.Value.addEdgeMain(cylinder);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div></div>

<h2 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h2><p>To show a connection between a node and the edge, we can add a LineRenderer to the edge as well as a spline (for that <mark class="tag-plugin colorful mark" color="yellow">visual curve</mark>). </p>
<!-- cell -->
<div class="tag-plugin colorful note" child="codeblock"><div class="body"><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Edge</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Edge</span>(<span class="params">GameObject source, GameObject target, <span class="built_in">string</span> ID, Material mat</span>)</span>&#123;</span><br><span class="line">        lr = <span class="keyword">new</span> GameObject().AddComponent&lt;LineRenderer&gt;();</span><br><span class="line">        spline = SimpleSpline.CreateSpline(lr.gameObject, source, target, lr);</span><br><span class="line"></span><br><span class="line">        lr.gameObject.transform.SetParent(source.transform, <span class="literal">false</span>);</span><br><span class="line">        lr.gameObject.name = ID;</span><br><span class="line">        lr.gameObject.transform.SetPositionAndRotation(Vector3.zero, Quaternion.identity);</span><br><span class="line">        lr.startWidth = <span class="number">0.2f</span>;</span><br><span class="line">        lr.endWidth = <span class="number">0.2f</span>;</span><br><span class="line">        Color startColor = Random.ColorHSV(<span class="number">0f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">0.5f</span>, <span class="number">1f</span>);</span><br><span class="line">        Color endColor = Random.ColorHSV(<span class="number">0f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">1f</span>, <span class="number">0.5f</span>, <span class="number">1f</span>);</span><br><span class="line">        <span class="built_in">float</span> alpha = <span class="number">1.0f</span>;</span><br><span class="line">        Gradient gradient = <span class="keyword">new</span> Gradient();</span><br><span class="line">        gradient.SetKeys(</span><br><span class="line">            <span class="keyword">new</span> GradientColorKey[] &#123; <span class="keyword">new</span> GradientColorKey(startColor, <span class="number">0.0f</span>), <span class="keyword">new</span> GradientColorKey(endColor, <span class="number">1.0f</span>) &#125;,</span><br><span class="line">            <span class="keyword">new</span> GradientAlphaKey[] &#123; <span class="keyword">new</span> GradientAlphaKey(alpha, <span class="number">0.0f</span>), <span class="keyword">new</span> GradientAlphaKey(alpha, <span class="number">1.0f</span>) &#125;</span><br><span class="line">        );</span><br><span class="line">        lr.material = mat;</span><br><span class="line">        lr.colorGradient = gradient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>


<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><strong>[1]</strong>: E. L. Ameres, “Reducing the cognitive load of visual analytics of networks using concentrically arranged multi-surface projections focusing immersive real-time exploration,” (2018)</li>
<li><strong>[2]</strong>: Campfire. <a target="_blank" rel="noopener" href="https://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=/netahtml%5B%E2%80%A6%5Dl=50&co1=AND&d=PTXT&s1=ameres.INNM.&OS=IN/ameres&RS=IN/ameres">https://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&amp;Sect2=HITOFF&amp;p=1&amp;u=%2Fnetahtml[…]l=50&amp;co1=AND&amp;d=PTXT&amp;s1=ameres.INNM.&amp;OS=IN/ameres&amp;RS=IN/ameres</a></li>
<li><strong>[3]</strong>: P. Eades, “A heuristic for graph drawing,” Congressus Numerantium, 42, 149–160 (1984)</li>
<li><strong>[4]</strong>: Chord Diagram. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Chord_diagram_(information_visualization)">https://en.wikipedia.org/wiki/Chord_diagram_(information_visualization)</a></li>
<li><strong>[5]</strong>: A. Beveridge, “Character Interaction Networks for George R. R. Martin’s “A Song of Ice and Fire” saga” <a target="_blank" rel="noopener" href="https://github.com/mathbeveridge/asoiaf">https://github.com/mathbeveridge/asoiaf</a>. (2017)</li>
</ul>
</article>



<footer class="page-footer footnote"><hr><div class="text"><p>Created by <a href="/">Zhi Zheng</a> with <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1">Stellar 1.29.1</a>.</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">

<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Abstract"><span class="toc-text">Abstract</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Abstract-Implementation"><span class="toc-text">Abstract Implementation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example"><span class="toc-text">Example</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Implementation"><span class="toc-text">Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-Parsing"><span class="toc-text">Data Parsing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nodes-and-Edges"><span class="toc-text">Nodes and Edges</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Graph"><span class="toc-text">Graph</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rendering"><span class="toc-text">Rendering</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#References"><span class="toc-text">References</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>Scroll to Top</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"post","path":"/search.json","content":true,"codeblock":false,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Ctrl+C`,
        success_text: `✔️`,
        toast: `Saved on Clipboard`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
